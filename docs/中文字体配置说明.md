# 中文字体显示问题解决方案

## 问题描述

在matplotlib绘图中，中文字符可能显示为方框（□），这是因为matplotlib默认不支持中文字体。

## 解决方案

本项目已在所有涉及matplotlib的模块中添加了中文字体配置。配置包括：

1. **自动字体配置**：所有脚本会自动尝试使用系统中可用的中文字体
2. **统一配置模块**：`src/utils/plotting_config.py` 提供了统一的字体配置函数
3. **跨平台支持**：支持Windows、macOS和Linux系统

## 字体优先级

1. **SimHei**（黑体）- Windows系统默认
2. **Microsoft YaHei**（微软雅黑）- Windows系统常用  
3. **PingFang SC**（苹方）- macOS系统默认
4. **DejaVu Sans** - 跨平台备选
5. **Arial Unicode MS** - 跨平台备选

## 手动安装字体（如果自动配置失败）

### Windows系统

1. 下载中文字体文件（如SimHei.ttf）
2. 双击字体文件安装，或复制到 `C:\Windows\Fonts\` 目录
3. 重启Python程序

### macOS系统

1. 下载中文字体文件
2. 双击安装或复制到 `/System/Library/Fonts/` 目录
3. 重启Python程序

### Linux系统

```bash
# Ubuntu/Debian
sudo apt-get install fonts-wqy-microhei fonts-wqy-zenhei

# CentOS/RHEL
sudo yum install wqy-microhei-fonts wqy-zenhei-fonts

# 或手动安装字体到 ~/.fonts/ 目录
mkdir -p ~/.fonts
cp *.ttf ~/.fonts/
fc-cache -fv
```

## 测试字体配置

运行以下命令测试中文字体是否正确配置：

```python
from src.utils.plotting_config import test_chinese_display, get_available_chinese_fonts

# 查看可用中文字体
print("可用中文字体:")
fonts = get_available_chinese_fonts()
for font in fonts:
    print(f"  - {font}")

# 生成测试图表
fig = test_chinese_display()
plt.show()
```

## 手动配置（备选方案）

如果自动配置失败，可以在脚本开头手动配置：

```python
import matplotlib.pyplot as plt

# 手动指定字体
plt.rcParams['font.sans-serif'] = ['SimHei']  # 指定具体字体
plt.rcParams['axes.unicode_minus'] = False

# 或使用项目配置
from utils.plotting_config import setup_chinese_fonts
setup_chinese_fonts()
```

## 已修复的文件

以下文件已添加中文字体配置：

- `src/visualization/budyko_plots.py`
- `src/visualization/direction_rose.py`
- `examples/01_real_data_workflow.py`
- `examples/complete_workflow_example.py`
- `examples/complex_integrated_analysis.py`
- `Scripts/integrated_china_analysis.py`

## 注意事项

1. 字体配置后需要重新运行Python程序才能生效
2. 如果仍有显示问题，请检查系统是否安装了中文字体
3. 在Jupyter Notebook中，可能需要重启kernel才能生效